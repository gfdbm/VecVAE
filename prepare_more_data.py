#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
准备更多训练数据的指导脚本

这个脚本展示如何准备足够的训练数据
"""

# ============================================
# 方案 1: 使用常用汉字列表
# ============================================

# 最常用的500个汉字（快速测试用）
COMMON_500 = """
的一是在不了有和人这中大为上个国我以要他时来用们生到作地于出就分对成会可主发年动同工也能下过子说产种面而方后多定行学法所民得经十三之进着等部度家电力里如水化高自二理起小物现实加量都两体制机当使点从业本去把性好应开它合还因由其些然前外天政四日那社义事平形相全表间样与关各重新线内数正心反你明看原又么利比或但质气第向道命此变条只没结解问意建月公无系军很情者最立代想已通并提直题党程展五果料象员革位入常文总次品式活设及管特件长求老头基资边流路级少图山统接知较将组见计别她手角期根论运农指几九区强放决西被干做必战先回则任取据处队南给色光门即保治北造百规热领七海口东导器压志世金增争济阶油思术极交受联什认六共权收证改清己美再采转更单风切打白教速花带安场身车例真务具万每目至达走积示议声报斗完类八离华名确才科张信马节话米整空元况今集温传土许步群广石记需段研界拉林律叫且究观越织装影算低持音众书布复容儿须际商非验连断深难近矿千周委素技备半办青省列习响约支般史感劳便团往酸历市克何除消构府称太准精值号率族维划选标写存候毛亲快效斯院查江型眼王按格养易置派层片始却专状育厂京识适属圆包火住调满县局照参红细引听该铁价严
"""

# GB2312 一级汉字（3755字）- 最推荐
GB2312_LEVEL1_RANGES = [
    (0x4E00, 0x9FA5),  # 基本汉字
]

# GB2312 完整（6763字）
GB2312_FULL_RANGES = [
    (0x4E00, 0x9FA5),  # 一级
    (0x3400, 0x4DB5),  # 扩展A（如果需要）
]

def get_common_chars(n=500):
    """获取最常用的n个汉字"""
    chars = COMMON_500.replace('\n', '').replace(' ', '')
    return list(chars[:n])

def get_gb2312_chars():
    """获取GB2312字符列表"""
    chars = []
    # 这里需要根据你的字体文件实际支持的字符来生成
    # 示例：
    for start, end in GB2312_LEVEL1_RANGES:
        for code in range(start, end + 1):
            char = chr(code)
            chars.append(char)
    return chars

# ============================================
# 使用指南
# ============================================

print("""
=============================================================
准备训练数据指南
=============================================================

当前问题：数据集只有 1 个样本，无法训练 VAE 模型。

解决方案：
-----------

方案 1: 准备更多字符数据（推荐）
--------------------------------

1. 快速测试（500字，~30分钟准备）：
   - 使用最常用的500个汉字
   - 足够验证管道是否工作
   - 命令示例：
     python build_dataset.py --font msyh.ttf --chars common500.txt --output data/msyh_500.npz

2. 标准训练（3000字，~2小时准备）：
   - 使用常用3000字
   - 能学到基本的字体规律
   - 推荐用于正式训练

3. 高质量（6763字，~5小时准备）：
   - GB2312完整字库
   - 生产级别质量
   
字符列表文件格式：
------------------
每行一个字符，或者直接一串字符：

# common500.txt
的一是在不了有和人这中大为...

# 或者每行一个
的
一
是
...


方案 2: 使用预训练模型（如果有）
--------------------------------
如果有其他人训练好的模型，可以：
1. 加载预训练权重
2. 在你的小数据集上微调


方案 3: 合成数据（临时方案）
----------------------------
如果实在没有数据，可以：
1. 从1个样本生成变体（旋转、缩放、噪声）
2. 但这不是长久之计，效果有限


当前状态分析：
-----------
样本数: 1
预期最少: 500-1000
推荐: 3000+

训练效果预测：
-----------
1个样本:    ❌ 完全过拟合，无意义
100样本:    ⚠️ 严重欠拟合，效果差
500样本:    🔶 能跑通，但质量低
1000样本:   ✅ 基本可用
3000样本:   ✅✅ 好
6000+样本:  ✅✅✅ 优秀


下一步行动：
-----------

1. 准备字符列表文件（选择上述方案之一）

2. 使用数据构建工具生成 .npz：
   python build_dataset.py \\
       --font /path/to/your/font.ttf \\
       --chars chars_list.txt \\
       --output data/msyh_large.npz \\
       --size 128

3. 更新训练命令：
   python train.py \\
       --npz data/msyh_large.npz \\
       --epochs 100 \\
       --batch 16

4. 监控训练：
   - 查看损失曲线
   - 定期检查 PNG 输出
   - 对比不同 epoch 的效果


常见问题：
---------

Q: 我没有字体文件怎么办？
A: 可以使用系统自带字体，如：
   - Linux: /usr/share/fonts/
   - Windows: C:\\Windows\\Fonts\\
   - macOS: /System/Library/Fonts/

Q: 数据构建很慢怎么办？
A: 
   - 先用500字测试管道
   - 确认可行后再准备完整数据
   - 可以并行处理

Q: 100个epoch是否太多？
A: 
   - 数据少时容易过拟合，100个可能太多
   - 建议：
     * 500样本: 20-30 epochs
     * 1000样本: 30-50 epochs  
     * 3000样本: 50-100 epochs
     * 6000+样本: 100+ epochs

=============================================================
""")

# 生成常用字符列表文件
def save_common_chars():
    """保存常用字符到文件"""
    chars = get_common_chars(500)
    with open('common_500.txt', 'w', encoding='utf-8') as f:
        f.write(''.join(chars))
    print(f"✅ 已保存 common_500.txt ({len(chars)} 字)")
    
    chars = get_common_chars(1000)
    with open('common_1000.txt', 'w', encoding='utf-8') as f:
        f.write(''.join(chars))
    print(f"✅ 已保存 common_1000.txt ({len(chars)} 字)")

if __name__ == "__main__":
    save_common_chars()
    print("\n请根据上述指南准备更多数据后再进行训练！")

